# Task Stream 项目数据结构设计

## 1. 核心实体说明

- **用户（User）**：系统用户，拥有任务、日志等数据。
- **任务（Task）**：日常任务，可作为长期任务的子任务。
- **长期任务（LongTermTask）**：跨周期的大型任务，支持进度追踪。
- **日志（Journal）**：每日记录。
- **AI助手消息（AiMessage）**：用户与AI助手的对话消息。

---

## 2. Python 数据模型

```python
from pydantic import BaseModel
from typing import Optional, List

class User(BaseModel):
    id: int                # 用户ID，主键
    username: str          # 用户名
    created_at: str        # 创建时间
    name: str              # 昵称
    passwordHash: str          # 密码哈希值
    
class Task(BaseModel):
    id: int                # 任务ID，主键
    user_id: int           # 用户ID（外键）
    title: str             # 任务标题
    description: Optional[str]       # 任务描述
    status: int            # 状态（1:todo, 2:in_progress, 3:done）
    due_date: Optional[str]    # 截止日期
    created_at: str        # 创建时间
    updated_at: str        # 更新时间
    assigned_date: Optional[str]    # 分配日期
    assigned_start_time: Optional[str]    # 分配开始时间
    assigned_end_time: Optional[str]    # 分配结束时间
    tags: Optional[List[str]] = []      #标签，长度最多为3的list，每个标签长度最多为10个字符
    record_result: Optional[bool] = False  # 是否记录成果
    result:Optional[str] = "" #成果描述
    result_picture_url: Optional[List[str]] = [] #成果图片URL
class LongTermTask(BaseModel):
    id: int                # 长期任务ID，主键
    user_id: int           # 用户ID（外键）
    title: str             # 长期任务标题
    description: Optional[str] # 长期任务描述
    start_date: str        # 开始日期
    end_date: Optional[str]    # 结束日期
    progress: float        # 进度百分比（0.0 ~ 1.0）
    subtasks: List[Task]    # 子任务列表
    created_at: str        # 创建时间

class Journal(BaseModel):
    date: str              # 日志日期（YYYY-MM-DD），主键
    user_id: int           # 用户ID（外键）
    content: str           # 日志内容

class AiMessage(BaseModel):
    id: int                # 消息ID，主键
    user_id: int           # 用户ID（外键）
    title: Optional[str]   # 会话标题
    timestamp: str         # 消息时间戳
    messages: List[dict]   # 消息内容（JSON字符串数组）

class Settings(BaseModel):
    id: int                # 设置ID，主键
    user_id: int           # 用户ID（外键）
    primary: str           # 强调色（HEX色值）
    bg: str                # 背景色（HEX色值）
    card: str              # 卡片色（HEX色值）
    text: str              # 文字色（HEX色值）
```

---

## 3.功能函数
```python
# 根据筛选日期范围获取范围内的全部任务
def get_tasks_in_date_range(start_date: str, end_date: str , user_id: int) -> List[Task]:
    # 从数据库查询在日期范围内的任务
    # 返回任务列表
    pass
# 获取所有长期任务
def get_all_long_term_tasks(user_id: int) -> List[LongTermTask]:
    # 从数据库查询所有长期任务
    # 返回长期任务列表
    pass
# 获取所有未完成的长期任务(按截止时间排序)
def get_all_uncompleted_long_term_tasks(user_id: int) -> List[LongTermTask]:
    # 从数据库查询所有未完成的长期任务
    # 返回长期任务列表
    pass
# 更新任务信息
def update_task(task_id: int, updated_task: Task ) -> bool:
    # 更新指定任务的信息
    # 返回是否更新成功
    pass
# 更新长期任务信息
def update_long_term_task(task_id: int, updated_task: LongTermTask , ) -> bool:
    # 更新指定长期任务的信息
    # 返回是否更新成功
    pass

# 获取对应日期的日志
def get_journal_by_date(date: str , user_id: int) -> Optional[Journal]:
    # 从数据库查询指定日期的日志
    # 返回日志对象（如果存在）
    pass
# 更新对应日期的日志内容
def update_journal_content(date: str, new_content: str , user_id: int) -> bool:
    # 更新指定日期的日志内容
    # 返回是否更新成功
    pass
# 根据年以及月份获取热力图信息
def get_heatmap_data(year: int, month: int , user_id: int) -> List[int]:
    # 从数据库查询指定年月份的任务完成情况
    # 返回热力图数据（每个日期的任务完成数量对应的颜色阶级，0~5）
    pass
```
