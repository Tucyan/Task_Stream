# 测试内容

本项目的测试以“保证主要功能可正常使用”为目标，采用以功能测试为主、结合少量静态检查与构建冒烟测试的方式完成。测试工作主要在本地开发环境中完成，不引入过于复杂的自动化平台与性能压测流程。

## 1. 测试目标

- 验证核心业务功能可用：登录/注册、任务管理、长期目标、日记、设置、AI 助手、提醒（移动端）。
- 验证前后端交互正确：前端请求参数、后端返回结构与错误处理符合预期。
- 避免回归：修复问题后，重复执行相关功能用例确认未引入新问题。

## 2. 测试范围与方法

### 2.1 测试范围

- 前端（`src/`）：React + Vite 的页面功能与组件交互（视图切换、弹窗、表单校验、任务列表刷新、主题切换等）。
- 后端（`backend/`）：FastAPI 接口功能正确性（CRUD、鉴权相关接口、AI 配置/对话接口、统计与日记接口）。
- 移动端（`android/`）：基于 Capacitor 的打包与本地通知（提醒）在 Android 真机/模拟器上的基本可用性。

### 2.2 测试方法

- 功能测试：依据用户使用流程执行测试用例，观察 UI 展示、接口响应与数据持久化结果。
- 接口测试：通过 FastAPI 的 Swagger UI（`/docs`）或浏览器/Fetch 调用验证接口返回与错误码。
- 冒烟测试（构建/静态检查）：在提交/交付前执行 `npm run lint` 与 `npm run build` 确认前端能正常构建并通过基础规则检查。

## 3. 测试环境与工具

### 3.1 环境

- 操作系统：Windows（本地开发环境）
- 前端：Node.js 18+，Vite（见 `package.json`）
- 后端：Python 3.11+，FastAPI + SQLAlchemy + SQLite（见 `backend/requirements.txt` 与 `backend/app/core/database.py`）
- 数据库：SQLite 文件库（默认 `backend/app/core/database.py` 中 `sqlite:///./task_stream.db`）
- 移动端：Android Studio / Gradle（通过 `npm run android:build`、`npm run android:release:apk`）

### 3.2 工具

- 前端静态检查：ESLint（`npm run lint`）
- 前端构建：Vite（`npm run build`）
- 后端接口调试：FastAPI Swagger UI（`http://localhost:8000/docs`）
- 移动端功能验证：Android 真机/模拟器通知权限与通知触发检查

## 4. 功能测试用例（核心）

说明：以下用例均以“能覆盖真实使用路径”为原则编写，执行时会结合 UI 行为与后端接口返回进行确认。

### 4.1 认证与用户资料（对应接口：`/api/v1/auth/*`）

| 用例编号 | 用例名称 | 操作步骤 | 预期结果 |
|---|---|---|---|
| AUTH-01 | 用户注册成功 | 打开应用 → 选择“注册新账号” → 输入账号/密码（可选昵称）→ 提交 | 返回用户信息并进入应用；再次打开应用可保持登录状态（本地存储存在 `taskStreamUser`） |
| AUTH-02 | 重复用户名注册 | 使用已注册用户名再次注册 | 后端返回 400；前端弹出“用户名已存在”等提示信息 |
| AUTH-03 | 登录成功 | 切换到登录 → 输入正确账号/密码 → 提交 | 登录成功并进入主页；`userId` 正确设置 |
| AUTH-04 | 登录失败 | 输入错误密码登录 | 后端返回 401；前端显示“用户名或密码错误/认证失败” |
| AUTH-05 | 修改昵称 | 进入设置/账户设置 → 修改昵称 → 点击更新 | 后端返回成功；前端用户昵称刷新（`UserProfile` 更新显示） |
| AUTH-06 | 修改密码 | 进入账户设置 → 输入当前密码与新密码 → 提交 | 当前密码正确时更新成功；错误时提示“当前密码错误” |

### 4.2 普通任务（对应接口：`/api/v1/tasks/*`）

| 用例编号 | 用例名称 | 操作步骤 | 预期结果 |
|---|---|---|---|
| TASK-01 | 新建任务 | 在“概览/详细日程”中点击新增 → 填写标题、日期/时间、截止日期等 → 保存 | 创建成功，列表刷新；刷新页面后任务仍存在（数据库持久化） |
| TASK-02 | 编辑任务 | 选择某条任务 → 编辑信息 → 保存 | 更新成功；重新进入页面仍为更新后的数据 |
| TASK-03 | 删除任务 | 选择某条任务 → 删除并确认 | 删除成功；任务不再出现在列表中 |
| TASK-04 | 查询任务详情 | 从列表进入详情或调用 `GET /tasks/{task_id}` | 任务存在时返回详情；不存在返回 404 |
| TASK-05 | 日期范围筛选 | 在详细页设置 `start_date`、`end_date` 筛选 | 只显示范围内任务；清除筛选后恢复全量 |
| TASK-06 | 紧急任务列表 | 调用 `GET /tasks/urgent?user_id=...` | 返回按截止时间排序的待处理任务列表 |

### 4.3 长期目标与子任务（对应接口：`/api/v1/long-term-tasks/*`）

| 用例编号 | 用例名称 | 操作步骤 | 预期结果 |
|---|---|---|---|
| LT-01 | 新建长期目标 | 进入“长期目标规划” → 新建目标 → 保存 | 创建成功，列表刷新 |
| LT-02 | 编辑长期目标 | 编辑标题/描述/截止日期/进度等 → 保存 | 更新成功，刷新后保持一致 |
| LT-03 | 删除长期目标 | 删除某条长期目标并确认 | 删除成功，列表移除 |
| LT-04 | 维护子任务 | 在长期目标中添加/编辑子任务并保存 | 子任务作为普通任务创建成功，同时长期目标的 `sub_task_ids` 能被更新并可在再次打开页面时正确加载 |

补充说明：长期目标的 `sub_task_ids` 在前后端交互中以字典形式维护（键为子任务 `task_id`，值为权重），测试中重点检查“新增子任务后长期目标能正确绑定子任务”，避免类型不一致导致更新失败。

### 4.4 日记与热力图（对应接口：`/api/v1/journals/*`、`/api/v1/stats/heatmap`）

| 用例编号 | 用例名称 | 操作步骤 | 预期结果 |
|---|---|---|---|
| JR-01 | 新建/更新日记 | 进入“每日日志” → 选择日期 → 输入内容并保存 | 保存成功；再次选择该日期仍能加载内容 |
| JR-02 | 获取有日志日期 | 切换月份，触发日历状态加载 | `dates/status` 返回后，日历中有日志日期高亮 |
| ST-01 | 热力图数据 | 进入概览页面，查看热力图 | 后端返回列表长度与月份天数匹配，页面显示与日记完成情况一致 |

### 4.5 设置（对应接口：`/api/v1/settings/*`）

| 用例编号 | 用例名称 | 操作步骤 | 预期结果 |
|---|---|---|---|
| SET-01 | 主题/颜色切换 | 在设置页切换深色模式、修改主题色 → 保存 | 页面整体样式即时变化；刷新后仍能保持（本地缓存 + 后端设置同步） |
| SET-02 | 重置主题 | 点击重置主题 | 颜色与模式恢复默认值 |

### 4.6 AI 助手（对应接口：`/api/v1/ai/*`）

| 用例编号 | 用例名称 | 操作步骤 | 预期结果 |
|---|---|---|---|
| AI-01 | 获取/保存 AI 配置 | 进入 AI 页面 → 打开设置 → 保存模型、Base URL 等配置 | 后端可保存并返回配置；再次进入仍能加载 |
| AI-02 | 创建对话与发送消息 | 新建对话 → 输入消息 → 发送 | 消息流式返回；页面能持续渲染内容并可滚动到最新消息 |
| AI-03 |  API Key 的提示 | 配置不存在的 `api_key` 直接发起对话 | 应给出合理的错误提示，不应造成页面崩溃 |

说明：AI 功能依赖外部模型服务与网络环境，测试重点放在“配置读写、对话创建、流式返回 UI 不崩溃、失败有提示”这些基础可用性上。

## 5. 移动端提醒功能测试（Android）

提醒功能依赖 Capacitor `@capacitor/local-notifications`。测试重点为“权限、计划任务、点击动作、延后”四部分：

- AND-01 权限申请：首次进入提醒相关功能时触发通知权限申请，拒绝后不应反复弹出导致无法使用其他功能。
- AND-02 通知触发：使用应用内“测试提醒”功能（10 秒后触发）检查通知是否按时出现。
- AND-03 点击动作：点击通知进入应用，弹出提醒处理界面（确认/延后）。
- AND-04 延后逻辑：点击“延后”后在设定分钟数后再次触发通知；延后时间修改后生效（本地 `taskStreamReminderSettings`）。

## 6. 测试总结

通过以上以功能测试为主的测试流程，能够覆盖项目的主要使用路径与关键接口交互，确保在本地演示与日常使用场景下“能登录、能增删改查任务、能维护长期目标与子任务、能写日记并展示统计、能保存设置、AI 页面可基本使用、移动端提醒可触发并支持延后”。本测试方案侧重实用性与可操作性，符合课程设计项目的实际工作量与能力范围。